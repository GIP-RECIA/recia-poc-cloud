version: '2.2'
services:
  nextcloud:
    build:
      context: .docker
      dockerfile: nextcloud/Dockerfile
    image: '${DOCKER_DEVBOX_REGISTRY}reciacloud/nextcloud'
    init: true
    restart: '${DOCKER_DEVBOX_RESTART_POLICY}'
    volumes:
      - '${COMPOSE_PROJECT_DIR}/volumes/nextcloud/config:/var/www/html/config'
      - '${COMPOSE_PROJECT_DIR}/volumes/nextcloud/custom_apps:/var/www/html/custom_apps'
      - '${COMPOSE_PROJECT_DIR}/volumes/nextcloud/data:/var/www/html/data'
      - '${COMPOSE_PROJECT_DIR}/volumes/nextcloud/themes/recia:/var/www/html/themes/recia'
  nextcloud-db:
    build:
      context: .docker
      dockerfile: nextcloud-db/Dockerfile
    image: '${DOCKER_DEVBOX_REGISTRY}reciacloud/nextcloud-db'
    init: true
    restart: '${DOCKER_DEVBOX_RESTART_POLICY}'
    environment:
      - 'POSTGRES_USER=postgres'
      - 'POSTGRES_PASSWORD=reciacloud'
    volumes:
      - '${COMPOSE_PROJECT_DIR}:/workdir'
      - 'nextcloud-db-data:/var/lib/postgresql/data'
  onlyoffice:
    build:
      context: .docker
      dockerfile: onlyoffice/Dockerfile
    image: '${DOCKER_DEVBOX_REGISTRY}reciacloud/onlyoffice'
    init: true
    restart: '${DOCKER_DEVBOX_RESTART_POLICY}'
volumes:
  nextcloud-db-data:
